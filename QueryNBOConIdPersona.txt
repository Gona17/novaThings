WITH clientes AS (SELECT DISTINCT CAST(Id_Cliente_Core AS BIGINT) as id_cliente_core, nro_cuit as id_persona 
FROM de_${entidad}_2cur.cliente_homologado
) 
SELECT rc.Id_Cliente_Core, rc.id_persona, ft.Id_Transaccion, ft.fecha_origen_mov AS fecha_transaccion, ft.mto_total AS mto_transaccion, CAST(ft.id_moneda AS STRING), 'MC' AS id_tarjetera, ft.id_rubro_mov AS id_rubro, CAST(pb.id_param AS INT) AS id_categoria 
FROM clientes rc 
INNER JOIN de_${entidad}_2cur.ft_ttcc_movimientos_credencial ft 
ON CAST(rc.id_cliente_core AS BIGINT) = ft.id_cliente_core 
INNER JOIN de_ber_1raw.param_bco_codigo_relacion pb 
ON ft.id_rubro_mov = CAST(pb.codigo_origen AS INT) 
WHERE ft.nro_cuota < 2 AND NVL(ft.id_rubro_mov,0) != 0 AND pb.nombre_parametro = 'Agrupamiento Rubros de Consumo - NBO Qualia' 

UNION ALL

SELECT rc.Id_Cliente_Core,rc.id_persona, ft.Id_Transaccion, ft.fecha_origen_movimiento, ft.mto_orig, ft.id_moneda_transaccion, 'VI' AS id_tarjetera, ft.id_rubro_movimiento, CAST(pb.id_param AS INT) 
FROM clientes rc 
INNER JOIN de_${entidad}_2cur.ft_ttcc_movimientos_prisma ft 
ON rc.id_cliente_core = CAST(ft.id_cliente_core AS BIGINT) 
INNER JOIN de_ber_1raw.param_bco_codigo_relacion pb 
ON ft.id_rubro_movimiento = CAST(pb.codigo_origen AS INT) 
WHERE ft.nro_cuota < 2
AND NVL(ft.id_rubro_movimiento,0) != 0 
AND pb.nombre_parametro = 'Agrupamiento Rubros de Consumo - NBO Qualia';